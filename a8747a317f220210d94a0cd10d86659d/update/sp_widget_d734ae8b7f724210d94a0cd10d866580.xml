<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function($rootScope,$scope, spUtil, spModal) {
	/* widget controller */
	var c = this;
	c.selectedID = null;
	c.selectItem = function(idx) {
		var id = c.data.groups[idx].sys_id;
		c.selectedID = id;
		$rootScope.group_id = id;
		$rootScope.group_name = c.data.groups[idx].name;
		$rootScope.$emit('selectGroup', id);
	};
	spUtil.recordWatch($scope, 'sn_splitwise_group', null);
	c.onAddGroupClick = function(){
		spModal.open({
			title:'Create new group',
			widget:'widget-form',
			buttons:
			[{
				label:'Close'
			}],
			widgetInput:{table:'sn_splitwise_group', sys_id:-1}
		});
	}
		c.onViewGroup = function(idx){
			if(idx <0 || idx >=c.data.groups.length) return;
		spModal.open({
			title:'Group Details',
			widget:'widget-form',
			buttons:[{
				label:'Close'
			}],
			widgetInput:{table:'sn_splitwise_group', sys_id:c.data.groups[idx].sys_id}
		});
	};
	c.onDeleteGroup = function(idx){
		spModal.confirm('Are you sure you want to delete the group '+c.data.groups[idx].name+'? This will delete all expenses within the group, however the balances will remain unchanged.').then(function(confirmed) {
			if(confirmed)
			{
				c.server.get({
					action:'deleteGroup',
					group_id:c.data.groups[idx].sys_id
				}).then(function(result){
					if(result.data.success)
					{
						spUtil.addInfoMessage("Group "+c.data.groups[idx].name+" deleted successfully");
					}
					else
						spUtil.addErrorMessage("Something went wrong. Failed to delete group "+c.data.groups[idx].name);
				});
			}
		});

	}
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.selectedItem{
  background-color:#e2e0ef;//#e7e5e5;
}
.glyphMargin{
  margin:0 5px 0 0;
}
.alertMargin{
  margin: 30px;
}
.list-group-item:hover{
  background-color:#e2e0ef !important;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>group_list</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Group list</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	var deleteGroup = function(group_id)
	{
		var gr = new GlideRecord('sn_splitwise_group');
		gr.addQuery('sys_id',group_id);
		gr.query();
		if(gr.next())
		{
			data.success = gr.deleteRecord();
		}
	}
	if(input && input.action=='deleteGroup')
		{
			deleteGroup(input.group_id);
		}
	else
		(function() {
			data.groups = [];
			var gr = new GlideRecord('sn_splitwise_group');
			var filter = "membersLIKE"+gs.getUserID();
			gr.addEncodedQuery(filter);
			gr.orderByDesc('sys_created_on');
			gr.query();
			while (gr.next()) {
				var obj = {};
				$sp.getRecordDisplayValues(obj, gr, 'sys_id,name,members');
				data.groups.push(obj);
			}
		})();

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-06-19 16:59:41</sys_created_on>
        <sys_id>d734ae8b7f724210d94a0cd10d866580</sys_id>
        <sys_mod_count>130</sys_mod_count>
        <sys_name>Group list</sys_name>
        <sys_package display_value="Splitwise" source="sn_splitwise">a8747a317f220210d94a0cd10d86659d</sys_package>
        <sys_policy/>
        <sys_scope display_value="Splitwise">a8747a317f220210d94a0cd10d86659d</sys_scope>
        <sys_update_name>sp_widget_d734ae8b7f724210d94a0cd10d866580</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-06-26 09:16:44</sys_updated_on>
        <template><![CDATA[<div class="containerBody">
  <button id="addGroupBtn" ng-click="c.onAddGroupClick()"
          class="btn btn-primary btn-{{options.color}} m-b">
    Add New Group
  </button>
  <div>
    <div class="panel panel-default" >
      <div class="panel-heading clearfix" >
        <h3 class="panel-title h4">
          <span class="glyphMargin">
            <fa name="user"></fa>
          </span>
          ${Groups}
        </h3>
      </div>
      <div class=" alertMargin alert alert-info" ng-if="!data.groups.length">
        ${Create a group to start splitting expenses}
      </div>
      <div class="list-group">
        <div class="list-group-item" ng-class="{ selectedItem: group.sys_id == c.selectedID }" ng-repeat="group in data.groups" ng-click="c.selectItem($index)">
          <button title="Delete group"
                  class="pull-right"
                  ng-click="c.onDeleteGroup($index)">
            <span>
              <fa name="trash"></fa>
            </span>
          </button>
          <button title="View Group Info"
                  class="pull-right"
                  style="margin-right:5px;"
                  ng-click="c.onViewGroup($index)">
            <span>
              <fa name="info-circle"></fa>
            </span>
          </button>
          <h4 class="list-group-item-heading">
            {{group.name}}
          </h4>

          <p class="list-group-item-text">
            {{group.members}}
          </p>

        </div>

      </div>
    </div>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
